package Test_Scenarios;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.time.Duration;
import org.openqa.selenium.By;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.WebElement;
import org.openqa.selenium.chrome.ChromeDriver;
import org.openqa.selenium.support.ui.WebDriverWait;

public class signUpWithPhone {

    public static void main(String[] args) {
        // Set up WebDriver
        WebDriver driver = new ChromeDriver();
        WebDriverWait wait = new WebDriverWait(driver, Duration.ofSeconds(20));

        // Maximize browser window
        driver.manage().window().maximize();
        driver.get("https://www.practina.com/demo");
        
        WebElement clickOnLoginButton=driver.findElement(By.xpath("(//p[@class='fs-16 fw-500 text-purple mb-0'])[2]"));
        clickOnLoginButton.click();
        
        WebElement phoneNumberField=driver.findElement(By.xpath("//input[@formcontrolname='contact']"));
        phoneNumberField.sendKeys("6283552808");
        
        WebElement otpField=driver.findElement(By.xpath("//span[@id='primaryButton']"));
        otpField.click();
        
        // Fetch OTP from the database
        String otp = getOTPFromDB();
        if (otp != null) {
            System.out.println("Retrieved OTP: " + otp);
            // Use the OTP in your Selenium tests
            WebElement otpFieldNumber = driver.findElement(By.xpath("//input[@formcontrolname='first']")); // Replace with actual ID
            otpFieldNumber.sendKeys(otp);
            
            // Continue with the rest of your Selenium actions...
        } else {
            System.out.println("No OTP found in the database.");
        }

        // Clean up
        driver.quit();
    }

    public static String getOTPFromDB() {
        String otp = null;
        try {
            Class.forName("com.mysql.cj.jdbc.Driver");
            Connection connection = DriverManager.getConnection(
                "jdbc:mysql://practina-live.czs1is1e6ezt.us-west-2.rds.amazonaws.com:3306/practina_live",

                "Kun@l-KumaR", "0mlTnBs3JWQKXdkt"
            );

            String sql = "SELECT otp_column_name FROM practina_live_table_name WHERE condition"; // Adjust your query
            PreparedStatement ps = connection.prepareStatement(sql);

            ResultSet rs = ps.executeQuery();

            if (rs.next()) {
                otp = rs.getString("otp_column_name"); // Replace with your actual OTP column name
            }

            // Clean up resources
            rs.close();
            ps.close();
            connection.close();
        } catch (Exception e) {
            e.printStackTrace();
        }
        return otp;
    }
}
