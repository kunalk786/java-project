package Test_Scenarios;
import java.awt.*;
import java.awt.datatransfer.StringSelection;
import java.awt.Toolkit;
import java.awt.datatransfer.Clipboard;
import java.awt.datatransfer.StringSelection;
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.time.Duration;
import org.openqa.selenium.By;
import org.openqa.selenium.Keys;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.WebElement;
import org.openqa.selenium.chrome.ChromeDriver;
import org.openqa.selenium.support.ui.WebDriverWait;

public class signUpWithPhone {

    public static void main(String[] args) throws InterruptedException {
        // Set up WebDriver
        WebDriver driver = new ChromeDriver();
        WebDriverWait wait = new WebDriverWait(driver, Duration.ofSeconds(20));

        // Maximize browser window
        driver.manage().window().maximize();
        driver.get("https://www.practina.com/demo");
        
        WebElement clickOnLoginButton=driver.findElement(By.xpath("(//p[@class='fs-16 fw-500 text-purple mb-0'])[2]"));
        clickOnLoginButton.click();
        
        WebElement phoneNumberField=driver.findElement(By.xpath("//input[@formcontrolname='contact']"));
        phoneNumberField.sendKeys("6283552808");
        
        WebElement otpField=driver.findElement(By.xpath("//span[@id='primaryButton']"));
        otpField.click();
        
        Thread.sleep(5000);
        
        // Fetch OTP from the database
        String otp = getOTPFromDB();
        if (otp != null) {
            System.out.println("Retrieved OTP: " + otp);
            // Use the OTP in your Selenium tests
            WebElement otpFieldNumber = driver.findElement(By.xpath("//input[@formcontrolname='first']"));
            copyToClipboard(otp);
            otpFieldNumber.sendKeys(Keys.COMMAND, "v");
            
            // Continue with the rest of your Selenium actions...
        } else {
            System.out.println("No OTP found in the database.");
        }

     
    }

    public static String getOTPFromDB() {
        String otp = null;
        try {
            Class.forName("com.mysql.cj.jdbc.Driver");
            Connection connection = DriverManager.getConnection(
                "jdbc:mysql://practina-live.czs1is1e6ezt.us-west-2.rds.amazonaws.com:1501/practina_live",

                "Kun@l-KumaR", "0mlTnBs3JWQKXdkt"
            );

            String sql = "SELECT otp FROM otp_report WHERE contact_no=6283552808"; // Adjust your query
            PreparedStatement ps = connection.prepareStatement(sql);

            ResultSet rs = ps.executeQuery();

            if (rs.next()) {
                otp = rs.getString("otp"); // Replace with your actual OTP column name
            }

         
            rs.close();
            ps.close();
            connection.close();
        } catch (Exception e) {
            e.printStackTrace();
        }
        return otp;
    }
    
    public static void copyToClipboard(String value) {
        // Create a StringSelection object that contains the string to be copied
        StringSelection stringSelection = new StringSelection(value);
        
        // Get the system clipboard
        Clipboard clipboard = Toolkit.getDefaultToolkit().getSystemClipboard();
        
        // Set the contents of the clipboard
        clipboard.setContents(stringSelection, null);
    }
}
